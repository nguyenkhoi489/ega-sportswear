(()=>{"use strict";var e=jQuery,t=(e("body"),function(t){var i;if(void 0!==e.fn.block){var n="#fff center center no-repeat";"undefined"!=typeof yith_wcan_shortcodes&&null!==(i=yith_wcan_shortcodes)&&void 0!==i&&i.loader&&(n="url('".concat(yith_wcan_shortcodes.loader,"') ").concat(n)),t.block({message:null,overlayCSS:{background:n,opacity:.7}})}}),i=function(t){void 0!==e.fn.unblock&&t.unblock()},n=function(t,i){var n=i.formatName,r=i.filterItems,a={},o=t.find(":input").not("[disabled]");return"function"==typeof r&&(o=o.filter(r)),o.each((function(){var t,i=e(this),r=i.attr("name");if(r&&(r=r.replace(/^(.*)\[]$/,"$1"),"function"==typeof n&&(r=n(r)),!i.is('[type="radio"]')||i.is(":checked")))if(t=i.val(),-1!==r.indexOf("[")){var o=r.split("[").map((function(e){return e.replace(/[\[, \]]/g,"")})),l=o.shift(),s=o.reverse().reduce((function(e,t){return function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}({},t,e)}),t);void 0===a[l]?a[l]=s:a[l]=e.extend(!0,a[l],s)}else a[r]=t})),a};function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function a(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){o(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var l=function(n,r,o,l){var s=e(this);o instanceof FormData?o.append("action","yith_wcan_".concat(r)):o=a({action:"yith_wcan_".concat(r)},o);var c=a({url:ajaxurl,data:o,dataType:"json",method:n,beforeSend:function(){return s.length&&t(s)},complete:function(){return s.length&&i(s)}},l);return e.ajax(c)};const s={request:l,get:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return l.call.apply(l,[this,"get"].concat(t))},post:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return l.call.apply(l,[this,"post"].concat(t))}};var c={taxonomy:{type:"tax"},use_all_terms:{type:"tax"},term_ids:{type:"tax",use_all_terms:"!:checked"},filter_design:{type:["tax","review","price_range"]},customize_terms:{type:"tax",use_all_terms:"!:checked"},terms_options:{term_ids:function(e){return!!e},customize_terms:":checked",__show:function(e){return e.afterTermsSelected()}},label_position:{filter_design:["color","label"]},column_number:{filter_design:["label","color"],label_position:["below","hide"]},show_search:{type:"tax",filter_design:"select"},price_ranges:{type:"price_range"},price_slider_adaptive_limits:{type:"price_slider"},price_slider_design:{type:"price_slider"},price_slider_min:{type:"price_slider",price_slider_adaptive_limits:"!:checked"},price_slider_max:{type:"price_slider",price_slider_adaptive_limits:"!:checked"},price_slider_step:{type:"price_slider"},order_options:{type:"orderby"},show_stock_filter:{type:"stock_sale"},show_sale_filter:{type:"stock_sale"},show_featured_filter:{type:"stock_sale"},toggle_style:{show_toggle:":checked"},order_by:{type:"tax"},order:{type:"tax"},show_count:{type:["tax","price_range","review","stock_sale"]},hierarchical:{type:"tax",filter_design:["checkbox","radio","text"]},multiple:{type:["tax","review","price_range"],filter_design:"!radio"},relation:{type:"tax",multiple:":checked"},adoptive:{type:["tax","price_range","review","stock_sale"]}};function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==i)return;var n,r,a=[],o=!0,l=!1;try{for(i=i.call(e);!(o=(n=i.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==i.return||i.return()}finally{if(l)throw r}}return a}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return u(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function f(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var p=function(){function e(t,i,n){var r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),h(this,"$container",void 0),h(this,"$fields",void 0),h(this,"dependencies",{}),h(this,"context",null),h(this,"checkFieldConditions",(function(e){for(var t=!0,i=0,n=Object.entries(e);i<n.length;i++){var r,a=d(n[i],2),o=a[0],l=a[1],s=void 0,c=void 0;if(t&&!["__show","__hide"].includes(o)&&(null!==(r=s=this.findField(o,!1))&&void 0!==r&&r.length)){var u,f;if(s.first().is('input[type="radio"]'))c=s.filter(":checked").val().toString();else c=null===(u=s)||void 0===u||null===(f=u.val())||void 0===f?void 0:f.toString();t=Array.isArray(l)?l.includes(c):"function"==typeof l?l(c,s,this.$container):0===l.indexOf(":")?s.is(l):0===l.indexOf("!:")?!s.is(l.toString().substring(1)):0===l.indexOf("!")?l.toString().substring(1)!==c:l.toString()===c,void 0!==this.dependencies[o]&&(t=t&&this.checkFieldConditions(this.dependencies[o]))}}return t})),this.$container=t,this.dependencies=i,this.context=n||{},null!==(r=this.$container)&&void 0!==r&&r.length&&(this.initFields(),null!==(a=this.$fields)&&void 0!==a&&a.length&&this.initDependencies())}var t,i,n;return t=e,(i=[{key:"initFields",value:function(){this.$fields=this.$container.find(":input")}},{key:"findField",value:function(e,t){var i;return"function"==typeof this.context.findField?this.context.findField(e,t):(i=this.$container.find(':input[name*="'.concat(e,'"]'))).length?t?i.closest(".yith-toggle-content-row"):i:null}},{key:"initDependencies",value:function(){Object.keys(this.dependencies).length&&this.handleDependencies()}},{key:"handleDependencies",value:function(){var e=this;this.$fields.on("change",(function(){return e.applyDependencies()})),this.applyDependencies()}},{key:"applyDependencies",value:function(){for(var e=0,t=Object.entries(this.dependencies);e<t.length;e++){var i=d(t[e],2),n=i[0],r=i[1],a=this.findField(n,!0);this.checkFieldConditions(r)?(null==a||a.css({display:"table"}),"function"==typeof(null==r?void 0:r.__show)&&(null==r||r.__show(this.context))):(null==a||a.hide(),"function"==typeof(null==r?void 0:r.__hide)&&(null==r||r.__hide(this.context)))}}}])&&f(t.prototype,i),n&&f(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function v(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var y=function(){function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),m(this,"id",void 0),m(this,"$term",void 0),m(this,"filter",void 0),e.length&&(this.$term=e,this.filter=t,e.hasClass("initialized")||this.init())}var a,o,l;return a=r,(o=[{key:"init",value:function(){this.initTabs(),this.initImageSelector(),this.initAdditionalColor(),this.initFields(),this.$term.addClass("initialized")}},{key:"initTabs",value:function(){var t=this;this.$term.find(".term-tab-header").on("click",(function(i){var n=e(i.target).data("tab");i.preventDefault(),t.showTab(n)})),this.showTab(this.$term.find(".term-mode").val())}},{key:"initImageSelector",value:function(){var n,r=this.$term.find(".image-selector"),a=r.find(".placeholder-image"),o=r.find(".selected-image"),l=o.find("img"),s=r.find(".term-image"),c=o.find(".clear-image");a.off("click").on("click",(function(){t(a),n||((n=wp.media({title:yith_wcan_admin.labels.upload_media,button:{text:yith_wcan_admin.labels.confirm_media},multiple:!1})).on("select",(function(){var t=n.state().get("selection").first().toJSON();l.remove(),l=e("<img/>",{src:t.url}),o.prepend(l),s.val(t.id).change(),i(a),a.hide(),o.show()})),n.on("close",(function(){i(a)}))),n.open()})),c.off("click").on("click",(function(){return s.val("").change(),o.hide(),a.show(),!1})),s.val()||c.click()}},{key:"initAdditionalColor",value:function(){var e=this,t=this.$term.find(".term-add-second-color"),i=this.$term.find(".term-hide-second-color"),n=this.$term.find(".additional-color").find("input"),r=n.val();t.on("click",(function(){return e.showAdditionalColor(),!1})),i.on("click",(function(){return e.hideAdditionalColor(),!1})),r&&r!==n.data("default-color")?this.showAdditionalColor():this.hideAdditionalColor()}},{key:"initFields",value:function(){var e=this;this.$term.trigger("yith_fields_init"),this.$term.find(".yith-plugin-fw-colorpicker--initialized").wpColorPicker("option","change",(function(){return e.filter.afterTermChanged(e)})),this.$term.on("change",":input",(function(){return e.filter.afterTermChanged(e)}))}},{key:"showTab",value:function(e,t){var i=this.$term.find(".term-tab-header"),n=this.$term.find(".tab"),r=n.filter(".tab-"+e);if(r.length&&(i.is(":visible")||t)){var a=this.$term.find(".term-mode"),o=a.val();i.removeClass("active").filter('[data-tab="'+e+'"]').addClass("active"),n.hide(),r.show(),a.val(e),o!==e&&a.change()}}},{key:"showAdditionalColor",value:function(){this.$term.find(".term-add-second-color").parent().hide().next(".additional-color").show().find(".wp-color-picker").prop("disabled",!1).change()}},{key:"hideAdditionalColor",value:function(){this.$term.find(".term-hide-second-color").parent().find(".wp-color-picker").prop("disabled",!0).val("").change().end().hide().prev("p").show()}},{key:"updateFields",value:function(e){var t=!1;switch(e){case"complete":this.$term.find(".term-tab-headers").show().find('a[data-tab="color"], span').show(),this.$term.find(".tab.tab-color").show(),this.$term.find(".tab.tab-image").show(),t=this.$term.find(".term-mode").val();break;case"colors_only":this.$term.find(".term-tab-headers").show().find('a[data-tab="image"], span').hide(),this.$term.find(".tab.tab-color").show(),this.$term.find(".tab.tab-image").hide(),t="color";break;case"image_only":this.$term.find(".term-tab-headers").show().find('a[data-tab="color"], span').hide(),this.$term.find(".tab.tab-color").hide(),this.$term.find(".tab.tab-image").show(),t="image";break;default:this.$term.find(".term-tab-headers").hide(),this.$term.find(".tab.tab-color").hide(),this.$term.find(".tab.tab-image").hide()}t&&this.showTab(t,!0)}},{key:"getId",value:function(){return this.id||(this.id=this.$term.data("term_id"))}},{key:"getData",value:function(){var e=n(this.$term,{formatName:function(e){return e.replace(/filters\[[0-9]+]\[terms]\[[0-9]+]\[([a-z0-9_-]+)]/,"$1")}});return e.term_id=this.getId(),e}}])&&v(a.prototype,o),l&&v(a,l),Object.defineProperty(a,"prototype",{writable:!1}),r}();function g(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var w=function(){function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),b(this,"id",void 0),b(this,"$range",void 0),b(this,"filter",void 0),e.length&&(this.$range=e,this.filter=i,e.hasClass("initialized")||this.init())}var i,n,r;return i=t,(n=[{key:"init",value:function(){this.initDependencies(),this.initRemove(),this.$range.addClass("initialized")}},{key:"initRemove",value:function(){var e=this;this.$range.find("a.range-remove").on("click",(function(t){t.preventDefault(),e.$range.remove(),e.filter.afterRangeDelete()}))}},{key:"initDependencies",value:function(){this.$range.find('[name*="unlimited"]').on("change",(function(){var t=e(this),i=t.closest(".range-box").find(".max");t.is(":checked")?i.hide():i.show()})).change()}},{key:"populate",value:function(e){var t=e.min,i=e.max,n=e.unlimited;this.$range.find(".min").find(":input").val(t),this.$range.find(".max").find(":input").val(i),this.$range.find(".unlimited").find(":input").prop("checked",n)}},{key:"toggleUnlimited",value:function(e){var t=this.$range.find(".unlimited"),i=t.find(":input");e&&t.show(),e||(i.prop("checked",!1).change(),t.hide())}},{key:"getId",value:function(){return this.id||(this.id=this.$range.data("range_id"))}}])&&g(i.prototype,n),r&&g(i,r),Object.defineProperty(i,"prototype",{writable:!1}),t}();function _(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||O(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function $(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=O(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==i.return||i.return()}finally{if(l)throw a}}}}function x(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function T(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?x(Object(i),!0).forEach((function(t){C(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):x(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==i)return;var n,r,a=[],o=!0,l=!1;try{for(i=i.call(e);!(o=(n=i.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==i.return||i.return()}finally{if(l)throw r}}return a}(e,t)||O(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){if(e){if("string"==typeof e)return S(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function j(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function C(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var F=function(){function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),C(this,"id",void 0),C(this,"$filter",void 0),C(this,"preset",void 0),C(this,"terms",new Map),C(this,"ranges",new Map),e.length&&(this.$filter=e,this.$toggleTitle=e.find(".yith-toggle-title"),this.$title=e.find("h3.title"),this.preset=t,e.hasClass("initialized")||this.init())}var a,o,l;return a=r,o=[{key:"init",value:function(){this.initTitle(),this.initToggle(),this.initSave(),this.initDelete(),this.initClone(),this.initTerms(),this.initRanges(),this.initDependencies(),this.initFields(),this.$filter.addClass("initialized")}},{key:"initTitle",value:function(){var e=this,t=this.$filter.find(".heading-field").first();this.$title.length&&t.length&&t.on("keyup",(function(){var i=t.val();e.$title.html(i||'<span class="no-title">'.concat(yith_wcan_admin.labels.no_title,"</span>"))}))}},{key:"initToggle",value:function(){var t=this;this.$toggleTitle.on("click",(function(i){e(i.target).closest(".filter-actions").length||(t.isOpen()?t.close():t.open())}))}},{key:"initDependencies",value:function(){new p(this.$filter,c,this)}},{key:"initFields",value:function(){this.$filter.trigger("yith_fields_init"),this.initTermSearch(),this.initCustomizeTerms(),this.initTaxonomy(),this.initType(),this.initDesign(),this.initCurrencyFields(),this.initErrorsHandling()}},{key:"initTermSearch",value:function(){var n=this,r=this.$filter.find(".term-search").first(),a=this.$filter.find(".taxonomy").first(),o=r.closest(".yith-plugin-fw-field-wrapper"),l=function(e){return{term:e.term,all:void 0!==e.all?e.all:0,taxonomy:a.val(),selected:r.val(),action:"yith_wcan_search_term",security:yith_wcan_admin.nonce.search_term}},s={placeholder:e(this).data("placeholder"),minimumInputLength:"1",templateSelection:function(e){return e.text.replace(/^(.*>)([^>]+)$/,"$2").replace("&amp;","&").trim()},templateResult:function(e){return e.text.replace("&amp;","&")},ajax:{url:ajaxurl,dataType:"json",delay:250,data:l,processResults:function(t){var i=[];return t&&e.each(t,(function(e,t){i.push({id:e,text:t})})),{results:i}},cache:!0},sorter:function(e){return e}};r.selectWoo(s),r.on("change",(function(e,t){return n.afterTermsSelected(t)})),o.find(".yith-plugin-fw-select-all").on("click",(function(s){return s.preventDefault(),!!n.confirmAddAllTerms(a)&&(t(o),e.get(ajaxurl,l({term:"",all:1})).then((function(t){var n=r.val();n||(n=[]),r.find("option").not(":selected").remove();for(var a=0,l=Object.entries(t);a<l.length;a++){var s=I(l[a],2),c=s[0],d=s[1];n.push(c),r.append(e("<option/>",{value:c,text:d}))}r.val(n).trigger("change",[!0]),i(o)})),!1)})),o.find(".yith-plugin-fw-deselect-all").on("click",(function(e){return e.preventDefault(),r.find("option").remove().end().val("").change(),!1}))}},{key:"initCustomizeTerms",value:function(){var e=this,t=this.$filter.find(".customize-terms").find("input"),i=this.$filter.find(".order-by");t.on("change",(function(){i.find('[value="include"]').prop("disabled",!t.is(":checked")),i.removeClass("enhanced").trigger("wc-enhanced-select-init"),!i.val()&&i.val("name"),e.afterTermsSelected()})).change()}},{key:"initTaxonomy",value:function(){var e=this,t=this.$filter.find(".taxonomy").first();this.$filter.find(".filter-design").first().on("change",(function(){return e.customizeTermsNotice()})),t.on("change",(function(){t.data("taxonomy")!==t.val()&&e.afterTaxonomyChange()}))}},{key:"afterTaxonomyChange",value:function(){this.$filter.find(".term-search").first().find("option").remove().end().change(),this.customizeTermsNotice()}},{key:"customizeTermsNotice",value:function(){var e,t,i,n=this.$filter.find(".taxonomy").first(),r=this.$filter.find(".filter-design").first(),a=this.$filter.find(".customize-terms").parent(),o=a.closest(".yith-toggle-content-row"),l=a.next(".description"),s=a.find("input"),c=l.find(".wccl-notice"),d=l.find(".images-notice"),u=n.data("taxonomies"),f=n.val(),h=r.val();yith_wcan_admin.yith_wccl_enabled&&null!==(e=u[f])&&void 0!==e&&e.is_attribute?c.show():c.hide(),null!==(t=u[f])&&void 0!==t&&t.supports_images&&"label"===h?d.show():d.hide(),"color"!==h||yith_wcan_admin.yith_wccl_enabled&&null!==(i=u[f])&&void 0!==i&&i.is_attribute?o.removeClass("disabled"):(s.prop("checked",!0),o.addClass("disabled"))}},{key:"initType",value:function(){var t=this.$filter.find(".filter-type"),i=this.$filter.find(".filter-design");t.on("change",(function(){for(var n=t.val(),r={review:["color","label"],price_range:["color","label"]},a=0,o=Object.entries(yith_wcan_admin.supported_designs);a<o.length;a++){var l,s=I(o[a],2),c=s[0],d=s[1],u=i.find('[value="'.concat(c,'"]'));null!=r&&null!==(l=r[n])&&void 0!==l&&l.includes(c)?u.remove():u.length||i.append(e("<option/>",{value:c,text:d}))}i.change()})).change()}},{key:"initDesign",value:function(){var e=this;this.$filter.find(".filter-design").on("change",(function(){return e.updateTermFields()})).change()}},{key:"initCurrencyFields",value:function(){this.$filter.find("[data-currency]").each((function(){var t=e(this),i=e("<span/>",{text:t.data("currency"),class:"currency"});t.after(i)}))}},{key:"initErrorsHandling",value:function(){var t=this;this.$filter.find(":input").on("invalid",(function(i){var n=i.target,r=e(n);i.preventDefault(),t.preset.goToFilter(t.$filter,r).done((function(){t.addInputValidationMessage(r,n.validationMessage)}))})),this.$filter.on("change keydown",":input",(function(){var t=e(this);t.hasClass("validation-error")&&(t.removeClass("validation-error").removeClass("required-field-empty"),t.next(".validation-message").remove())}))}},{key:"initSave",value:function(){var e=this;this.$filter.find(".save").on("click",(function(){return e.maybeSave(),!1}))}},{key:"initClone",value:function(){var e=this;this.$filter.find(".clone").on("click",(function(){return e.clone()}))}},{key:"initDelete",value:function(){var e=this;this.$filter.find(".delete").on("click",(function(){return e.maybeDelete()}))}},{key:"maybeSave",value:function(){var e=this;if(!this.validate())return!1;this.save().done((function(t){e.preset.maybeSetId(null==t?void 0:t.id),e.close()}))}},{key:"save",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.preset.getId(),i=this.getData(),n=this.getId(),r=this.$filter.prev(".filter-row"),a=this.getTermsPool(),o=r.length?r.attr("id").replace("filter_",""):-1;return i.terms=Object.fromEntries(a.map((function(e){return[e.term_id,e]}))),i.terms_order=a.map((function(e){return e.term_id})),s.post.call(e?this.$filter:null,"save_preset_filter",{preset:t,filter:i,filter_id:n,prev_filter_id:o,_wpnonce:yith_wcan_admin.nonce.save_preset_filter})}},{key:"clone",value:function(){this.preset.addFilter(this.getData())}},{key:"maybeDelete",value:function(){var e=this;confirm(yith_wcan_admin.messages.confirm_delete)&&this.delete().then((function(){e.$filter.remove(),e.preset.afterFilterDelete(e)}))}},{key:"delete",value:function(){var e=this.preset.getId();if(!e)return Promise.resolve();var t=this.getId();return t?s.post.call(this.$filter,"delete_preset_filter",{preset:e,filter_id:t,_wpnonce:yith_wcan_admin.nonce.delete_preset_filter}):Promise.resolve()}},{key:"validate",value:function(){var e=this.preset.$layout.find(":checked").val(),t=this.findField("title",!1),i=t.val();return"horizontal"!==e||i?this.$filter.find(":input").get().reduce((function(e,t){return e&&t.reportValidity()}),!0):(this.addInputValidationMessage(t,yith_wcan_admin.messages.filter_title_required),this.preset.goToFilter(this),!1)}},{key:"updateLayout",value:function(e){var t=this.findField("show_toggle"),i=this.findField("tooltip",!1);"horizontal"===e?(null==t||t.hide().find(":input").prop("checked",!1).val("no").change(),null==i||i.parent().hide()):(null==t||t.show(),null==i||i.parent().show())}},{key:"getId",value:function(){return this.id||(this.id=this.$filter.attr("id").replace("filter_",""))}},{key:"getRowIndex",value:function(){return this.$filter.data("item_key")}},{key:"getData",value:function(){return T(T({},n(this.$filter,{formatName:function(e){return e.replace(/filters\[[0-9]+]\[([a-z_-]+)]/,"$1")},filterItems:function(t,i){return!e(i).is('[name*="[terms]"]')}})),{},{terms:this.getTermsPool()})}},{key:"populate",value:function(t){var i=this.getId();for(var n in t){var r=t[n],a="terms"===n?"filters_".concat(i,"_term_ids"):"filters_".concat(i,"_").concat(n),o=this.$filter.find("#".concat(a));if(o.length||"price_ranges"===n)if("terms"===n){var l,s=$(r);try{for(s.s();!(l=s.n()).done;){var c=l.value;if(null!=c&&c.label){var d=e("<option/>",{value:c.term_id,text:c.label,selected:!0});o.append(d)}}}catch(e){s.e(e)}finally{s.f()}this.$filter.find(".terms-wrapper").data("terms",r),o.val(r.map((function(e){return e.term_id}))).change(),this.updateTerms(!0)}else if("price_ranges"===n){var u=r;if("object"!==k(u))continue;for(var f in u){var h=u[f];this.addRange(h)}}else o.is(":checkbox")?o.prop("checked","yes"===r).val(r).change():o.is('[data-type="radio"]')?o.find(":input").prop("checked",!1).filter('[value="'+r+'"]').prop("checked",!0).change():"title"===n?o.val(t[n]).keyup():"taxonomy"===n?o.data("taxonomy",r).val(r):o.val(t[n]).change()}}},{key:"isOpen",value:function(){return this.$filter.hasClass("filter-row-opened")}},{key:"open",value:function(){return this.$toggleTitle.find(".title-arrow").removeClass("yith-icon-arrow-right-alt").addClass("yith-icon-arrow-down-alt"),this.$filter.addClass("filter-row-opened").find(".yith-toggle-content").slideDown().promise()}},{key:"isClosed",value:function(){return!this.isOpen()}},{key:"close",value:function(){var e=this;return this.$filter.find(".yith-toggle-title").find(".title-arrow").addClass("yith-icon-arrow-right-alt").removeClass("yith-icon-arrow-down-alt"),this.$filter.find(".yith-toggle-content").slideUp(400,(function(){e.$filter.removeClass("filter-row-opened")})).promise()}},{key:"getTermsPool",value:function(){return _(this.$filter.find(".terms-wrapper").data("terms").values()).filter((function(e){return!!e}))}},{key:"getTermsToShow",value:function(){var e=this.getTermsPool(),t=parseInt(yith_wcan_admin.terms_per_page);return e&&this.termsPaginated&&t&&Object.keys(e).length>t?e=e.slice(0,t):this.$filter.find(".show-more-terms").hide(),e}},{key:"getTermsType",value:function(){var e=this.$filter.find(".filter-design"),t=null==e?void 0:e.val();return"label"!==t&&"color"!==t?"labels_only":"color"===t?"complete":"image_only"}},{key:"initTerms",value:function(){var t=this,i=this.$filter.find(".term-box"),n=this.$filter.find(".order-by"),r=this.$filter.find(".show-more-terms");this.termsPaginated=!!this.$filter.find(".show-more-terms").length;var a,o=$(i.get());try{for(o.s();!(a=o.n()).done;){var l=a.value,s=e(l),c=new y(s,this);this.terms.set(c.getId(),c)}}catch(e){o.e(e)}finally{o.f()}r.on("click",(function(){return t.showMoreTerms()})),n.on("change",(function(){var e=n.val();t["include"===e?"initTermsDragDrop":"destroyTermsDragDrop"]()})).change(),this.updateTermFields()}},{key:"initTermsDragDrop",value:function(){var e=this;try{this.$filter.find(".terms-wrapper").sortable({cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",stop:function(){var t=e.getTermsPool(),i=[];e.$filter.find(".term-box").get().map((function(e){return parseInt(e.dataset.term_id)})).forEach((function(e){var n=t.findIndex((function(t){return t.term_id===e}));i.push(t[n])})),e.termsPaginated&&(i=i.concat(t.slice(yith_wcan_admin.terms_per_page))),e.$filter.find(".terms-wrapper").data("terms",i)}})}catch(e){}}},{key:"destroyTermsDragDrop",value:function(){try{this.$filter.find(".terms-wrapper").sortable("destroy")}catch(e){}}},{key:"afterTermsSelected",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this.$filter.find(".term-search"),n=i.val().map((function(e){return parseInt(e)})),r=this.getTermsPool(),a=this.getTermsType(),o=r.map((function(e){return e.term_id})),l=n.filter((function(e){return!o.includes(e)})),s=o.filter((function(e){return!n.includes(e)}));s.forEach((function(e){delete r[r.findIndex((function(t){return e===(null==t?void 0:t.term_id)}))]})),l.forEach((function(t){var n=i.find('[value="'.concat(t,'"]')).text();r.push({id:e.getId(),term_id:t,label:n,name:n,color_1:"#007694",color_2:"",mode:"images_only"===a?"image":"color"})})),(s.length||l.length)&&(l.length&&(this.termsPaginated=!1),this.$filter.find(".terms-wrapper").data("terms",r),this.updateTerms(t))}},{key:"afterTermChanged",value:function(e){var t=this.getTermsPool(),i=e.getId(),n=t.findIndex((function(e){return i===(null==e?void 0:e.term_id)}));t[n]=e.getData(),this.$filter.find(".terms-wrapper").data("terms",t)}},{key:"updateTerms",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this.$filter.find(".terms-wrapper");if(t||i.is(":visible")){var n=this.getTermsToShow(),r=new Map,a=wp.template("yith-wcan-filter-term"),o=i.find(".term-box");if(o.detach(),n){var l,s=$(n);try{for(s.s();!(l=s.n()).done;){var c=l.value,d=void 0,u=void 0;(u=this.terms.has(c.term_id)?(d=this.terms.get(c.term_id)).$term:e(a(c))).length&&i.append(u),d||(d=new y(u,this)),d&&r.set(c.term_id,d)}}catch(e){s.e(e)}finally{s.f()}}this.terms=r,this.updateTermFields()}}},{key:"showMoreTerms",value:function(){this.termsPaginated=!1,this.updateTerms()}},{key:"updateTermFields",value:function(){var e=this.getTermsType();_(this.terms.values()).map((function(t){return t.updateFields(e)}))}},{key:"confirmAddAllTerms",value:function(){var e,t,i,n=this.$filter.find(".taxonomy").first(),r=n.val(),a=n.data("taxonomies"),o=yith_wcan_admin.messages.confirm_add_all_terms;return!(null!==(e=a[r])&&void 0!==e&&e.terms_count&&(null===(t=a[r])||void 0===t?void 0:t.terms_count)>1)||confirm(o.replace("%s",null===(i=a[r])||void 0===i?void 0:i.terms_count))}},{key:"initRanges",value:function(){var t=this.$filter.find(".range-box");this.initAddRange(),this.initRangesDragDrop();var i,n=$(t.get());try{for(n.s();!(i=n.n()).done;){var r=i.value,a=e(r),o=new w(a,this);this.ranges.set(o.getId(),o)}}catch(e){n.e(e)}finally{n.f()}this.initRangesPosition()}},{key:"initAddRange",value:function(){var e=this;this.$filter.find(".add-price-range").on("click",(function(t){t.preventDefault(),e.addRange(),e.initRangesPosition()}))}},{key:"initRangesPosition",value:function(){var e,t=$(this.ranges.values());try{for(t.s();!(e=t.n()).done;){var i=e.value;i.toggleUnlimited(i.$range.is(":last-child"))}}catch(e){t.e(e)}finally{t.f()}}},{key:"initRangesDragDrop",value:function(){var e=this;this.$filter.find(".ranges-wrapper").sortable({cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",stop:function(){var t,i=function(e,t){return function(i,n){return n.replace(e,t)}},n=$(e.ranges.values());try{for(n.s();!(t=n.n()).done;){var r=t.value.$range,a=r.index(),o=i(r.data("range_id"),a);r.data("range_id",a).find(":input").attr("name",o).attr("id",o)}}catch(e){n.e(e)}finally{n.f()}e.initRangesPosition()}})}},{key:"addRange",value:function(t,i){var n=wp.template("yith-wcan-filter-range")({id:this.getRowIndex(),range_id:i||this.getNextRangeIndex(),min:0,max:0}),r=e(n),a=new w(r,this);return t&&a.populate(t),this.ranges.set(a.getId(),a),this.$filter.find(".ranges-wrapper").append(r),r}},{key:"afterRangeDelete",value:function(e){this.ranges.delete(e.getId()),this.initRangesPosition()}},{key:"findField",value:function(e){var t,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(e){case"terms_options":t=this.$filter.find(".terms-wrapper");break;case"price_ranges":t=this.$filter.find(".ranges-wrapper");break;default:t=this.$filter.find(':input[name*="['+e+']"]')}return t.length?i?t.closest(".yith-toggle-content-row"):t:null}},{key:"getNextRangeIndex",value:function(){var e,t=this.$filter.find(".ranges-wrapper"),i=t.data("index");return i||(i=_(this.ranges.values()).reduce((function(e,t){return Math.max(e,t.getId())}),0)),e=++i,t.data("index",e),e}},{key:"addInputValidationMessage",value:function(t,i){var n=e("<span/>",{class:"validation-message",text:i});t.addClass("required-field-empty").addClass("validation-error").next(".validation-message").remove().end().after(n)}}],o&&j(a.prototype,o),l&&j(a,l),Object.defineProperty(a,"prototype",{writable:!1}),r}();function D(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=A(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,l=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){l=!0,a=e},f:function(){try{o||null==i.return||i.return()}finally{if(l)throw a}}}}function P(e){return function(e){if(Array.isArray(e))return R(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||A(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){if(e){if("string"==typeof e)return R(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?R(e,t):void 0}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function z(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function E(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var M=function(){function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),E(this,"rowIndex",0),E(this,"$wrapper",void 0),E(this,"$mainAddNewFilterButton",void 0),E(this,"$loadMoreFiltersButtons",void 0),E(this,"$filtersContainer",void 0),E(this,"$layout",void 0),E(this,"$page",void 0),E(this,"filters",new Map),e.length&&(this.$wrapper=e,this.$mainAddNewFilterButton=this.$wrapper.find("#add_new_filter"),this.$filtersContainer=this.$wrapper.find(".preset-filters"),this.$layout=this.$wrapper.find("#preset_layout"),this.$page=this.$wrapper.find("#paged"),this.$loadMoreFiltersButtons=this.$wrapper.find(".load-more-filters"),this.init())}var r,a,o;return r=i,o=[{key:"getRowIndex",value:function(e){var t=e.data("item_key");return t?parseInt(t):0}}],(a=[{key:"init",value:function(){this.initFilters(),this.initAddFilter(),this.initLoadMoreFilters(),this.initLayout(),this.initSubmit()}},{key:"initAddFilter",value:function(){var e=this;this.$wrapper.find(".add-new-filter").on("click",(function(){return e.addFilter(),!1}))}},{key:"initLoadMoreFilters",value:function(){var e=this;this.$loadMoreFiltersButtons.on("click",(function(){return e.loadMoreFilters(),!1}))}},{key:"initSubmit",value:function(){var e=this;this.$wrapper.find("#submit").on("click",(function(i){return!!e.$wrapper.find("form").get(0).reportValidity()&&!!e.validateFilters()&&(i.preventDefault(),t(e.$wrapper),s.post.call(null,"save_preset",e.getData()).then((function(t){e.maybeSetId(null==t?void 0:t.id);var i=P(e.filters.values()).map((function(e){return e.save(!1)}));return Promise.all(i)})).then((function(){return window.location=e.getUrl()})))}))}},{key:"initLayout",value:function(){var e=this;this.$layout.on("change","input",(function(){return e.afterLayoutChange()})).find("input").first().change()}},{key:"initFilters",value:function(){this.initFiltersDragDrop();var t,i=D(this.$filtersContainer.find(".filter-row").get());try{for(i.s();!(t=i.n()).done;){var n=t.value,r=e(n),a=new F(r,this);this.filters.set(a.getId(),a)}}catch(e){i.e(e)}finally{i.f()}}},{key:"initFiltersDragDrop",value:function(){this.$filtersContainer.sortable({cursor:"move",handle:".yith-toggle-title",axis:"y",scrollSensitivity:40,forcePlaceholderSize:!0})}},{key:"afterLayoutChange",value:function(){var e,t=this.$layout.find(":checked").val(),i=D(this.filters.values());try{for(i.s();!(e=i.n()).done;)e.value.updateLayout(t)}catch(e){i.e(e)}finally{i.f()}}},{key:"filterExists",value:function(e){return this.filters.has(e)}},{key:"addFilter",value:function(t,i){var n=wp.template("yith-wcan-filter")({id:i||this.nextRowIndex(),key:this.filters.size}),r=e(n),a=new F(r,this);return t&&a.populate(t),this.$filtersContainer.append(r),this.afterFilterAdd(a),r}},{key:"afterFilterAdd",value:function(e){var t=this;this.filters.set(e.getId(),e),this.closeAllFilters().then((function(){return t.goToFilter(e)})),this.updateRowIndex(),this.maybeHideEmptyBox(),this.$mainAddNewFilterButton.show()}},{key:"afterFilterDelete",value:function(e){this.filters.delete(e.getId()),this.maybeShowEmptyBox(),this.filters.size||this.$mainAddNewFilterButton.hide()}},{key:"closeAllFilters",value:function(){var e=P(this.filters.values()).map((function(e){return e.close()}));return Promise.all(e)}},{key:"loadMoreFilters",value:function(){var e=this,t=this.$page.val();s.get.call(this.$loadMoreFiltersButtons,"load_more_filters",{preset:this.getId(),page:++t,_wpnonce:yith_wcan_admin.nonce.load_more_filters}).done((function(i){if(i){if(i.filters){var n,r=D(i.filters);try{for(r.s();!(n=r.n()).done;){var a=n.value,o=a.id;e.filterExists(o)||e.addFilter(a,o)}}catch(e){r.e(e)}finally{r.f()}}i.has_more?e.$page.val(t):(e.$loadMoreFiltersButtons.remove(),e.$page.remove(),e.$page=null)}}))}},{key:"validateFilters",value:function(){return P(this.filters.values()).reduce((function(e,t){return e&&t.validate()}),!0)}},{key:"goToFilter",value:function(t,i){return t.isOpen()?(i=i||t.$filter,e("html, body").stop(!0).animate({scrollTop:i.offset().top-100}).promise()):e("html, body").stop(!0).animate({scrollTop:t.$filter.offset().top-100}).promise().done((function(){t.open(),i&&i.length&&e("html, body").animate({scrollTop:i.offset().top-100})}))}},{key:"getId",value:function(){return this.$wrapper.find("#preset_id").val()}},{key:"getUrl",value:function(){var e=new URL(window.location),t=this.getId();return t&&(e.searchParams.set("action","edit"),e.searchParams.set("preset",t)),e.toString()}},{key:"maybeSetId",value:function(e){!this.getId()&&e&&this.$wrapper.find("#preset_id").val(e)}},{key:"updateRowIndex",value:function(){var e=this.$filtersContainer.data("max-filter-id"),t=Math.max.apply(Math,P(this.filters.keys()));this.rowIndex=Math.max(e,t)}},{key:"nextRowIndex",value:function(){return this.rowIndex||this.updateRowIndex(),++this.rowIndex}},{key:"currentRowIndex",value:function(){return this.rowIndex||this.updateRowIndex(),this.rowIndex}},{key:"getData",value:function(){return n(this.$wrapper,{filterItems:function(t,i){return!e(i).is('[name^="filters"]')}})}},{key:"maybeShowEmptyBox",value:function(){var e=this.$filtersContainer.children(".yith-wcan-admin-no-post");!e.length||e.is(":visible")||this.filters.size||e.show()}},{key:"maybeHideEmptyBox",value:function(){var e=this.$filtersContainer.children(".yith-wcan-admin-no-post");e.length&&e.is(":visible")&&this.filters.size&&e.hide()}}])&&z(r.prototype,a),o&&z(r,o),Object.defineProperty(r,"prototype",{writable:!1}),i}();jQuery((function(e){var t=e("#yith_wcan_panel_filter-preset-edit");t.length&&e(document).on("yith_wcan_filters_init",(function(){new M(t)})).trigger("yith_wcan_filters_init")}))})();